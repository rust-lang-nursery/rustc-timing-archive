commit fb62f4d544c954d355716dca8beb55726036721e
Merge: cde61ba af1a3ff
Author: bors <bors@rust-lang.org>
Date:   Sat Sep 17 08:23:44 2016 -0700

    Auto merge of #36490 - bluss:zip-slightly-despecialized-edition, r=alexcrichton
    
    Remove data structure specialization for .zip() iterator
    
    Go back on half the specialization, the part that changed the Zip
    struct's fields themselves depending on the types of the iterators.
    
    Previous PR: #33090
    
    This means that the Zip iterator will always carry two usize fields,
    which are sometimes unused. If a whole for loop using a .zip() iterator is
    inlined, these are simply removed and have no effect.
    
    The same improvement for Zip of for example slice iterators remain, and
    they still optimize well. However, like when the specialization of zip
    was merged, the compiler is still very sensistive to the exact context.
    
    For example this code only autovectorizes if the function is used, not
    if the code in zip_sum_i32 is inserted inline where it was called:
    
    ```rust
    fn zip_sum_i32(xs: &[i32], ys: &[i32]) -> i32 {
        let mut s = 0;
        for (&x, &y) in xs.iter().zip(ys) {
            s += x * y;
        }
        s
    }
    
    fn zipdot_i32_default_zip(b: &mut test::Bencher)
    {
        let xs = vec![1; 1024];
        let ys = vec![1; 1024];
    
        b.iter(|| {
            zip_sum_i32(&xs, &ys)
        })
    }
    ```
    
    Include a test that checks that `Zip<T, U>` is covariant w.r.t. T and U.
    
    Fixes #35727
cfg: version 1.13.0-dev (fb62f4d54 2016-09-17)
cfg: build triple x86_64-unknown-linux-gnu
cfg: host triples x86_64-unknown-linux-gnu
cfg: target triples x86_64-unknown-linux-gnu
cfg: host for x86_64-unknown-linux-gnu is x86_64
cfg: os for x86_64-unknown-linux-gnu is unknown-linux-gnu
cfg: have good valgrind for x86_64-unknown-linux-gnu
cfg: using CC=gcc (CFG_CC)
cfg: disabling valgrind run-pass tests
rustc: x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd
/root/rust/mk/target.mk:212: recipe for target 'x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.std' failed
