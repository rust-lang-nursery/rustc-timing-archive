commit c7ab8840c8cfcd62e9f7212371ed3e31ad2ae73a
Merge: 80ec1b9 42eb703
Author: bors <bors@rust-lang.org>
Date:   Tue May 10 23:40:09 2016 -0700

    Auto merge of #33425 - eddyb:rift, r=nikomatsakis
    
    Split the type context into a global and a local (inference-only) one.
    
    After this change, each `InferCtxt` creates its own local type interner for types with inference by-products.
    Most of the code which handles both a global and a local interner uses `'gcx` and `'tcx` for them.
    A reference to the type context in that situation (e.g. `infcx.tcx`) is `TyCtxt<'a, 'gcx, 'tcx>`.
    The global type context which used to be `&'a TyCtxt<'tcx>` is now `TyCtxt<'a, 'tcx, 'tcx>`.
    
    In order to minimize the number of extra lifetime parameters, many functions became methods.
    Where possible (some inherent impls), lifetime parameters were added on the impl, not each method.
    
    As inference by-products no longer escape their inference contexts, memory usage is lower.
    Example of `-Z time-passes` excerpt for `librustc`, stage1 (~100MB gains):
    Before "rustc: Split local type contexts interners from the global one.":
    ```
    time: 0.395; rss: 335MB item-types checking
    time: 15.392; rss: 472MB        item-bodies checking
    time: 0.000; rss: 472MB drop-impl checking
    time: 1.140; rss: 478MB const checking
    time: 0.139; rss: 478MB privacy checking
    time: 0.024; rss: 478MB stability index
    time: 0.072; rss: 478MB intrinsic checking
    time: 0.038; rss: 478MB effect checking
    time: 0.255; rss: 478MB match checking
    time: 0.128; rss: 484MB liveness checking
    time: 1.372; rss: 484MB rvalue checking
    time: 1.404; rss: 597MB MIR dump
    time: 0.809; rss: 599MB MIR passes
    ```
    After:
    ```
    time: 0.467; rss: 337MB item-types checking
    time: 17.443; rss: 395MB        item-bodies checking
    time: 0.000; rss: 395MB drop-impl checking
    time: 1.423; rss: 401MB const checking
    time: 0.141; rss: 401MB privacy checking
    time: 0.024; rss: 401MB stability index
    time: 0.116; rss: 401MB intrinsic checking
    time: 0.038; rss: 401MB effect checking
    time: 0.382; rss: 401MB match checking
    time: 0.132; rss: 407MB liveness checking
    time: 1.678; rss: 407MB rvalue checking
    time: 1.614; rss: 503MB MIR dump
    time: 0.957; rss: 512MB MIR passes
    ```
    
    **NOTE**: Functions changed to methods weren't re-indented to keep this PR easier to review.
    Once approved, the changes will be mechanically performed.
    However, indentation changes of function arguments are there - and I believe there's a way to hide whitespace-only changes in diffs on GitHub.
rustc: ./helloworld
/root/rust/x86_64-unknown-linux-gnu/stage2/bin/rustc hello.rs -Ztime-passes -Zinput-stats
time: 0.000; rss: 45MB	parsing
Lines of code:             3
Pre-expansion node count:  8
time: 0.000; rss: 45MB	configuration 1
time: 0.000; rss: 45MB	recursion limit
time: 0.000; rss: 45MB	crate injection
time: 0.003; rss: 51MB	macro loading
time: 0.000; rss: 51MB	plugin loading
time: 0.000; rss: 51MB	plugin registration
time: 0.001; rss: 51MB	expansion
time: 0.000; rss: 51MB	configuration 2
time: 0.000; rss: 51MB	gated configuration checking
time: 0.000; rss: 51MB	maybe building test harness
time: 0.000; rss: 51MB	prelude injection
time: 0.000; rss: 51MB	checking that all macro invocations are gone
time: 0.000; rss: 51MB	checking for inline asm in case the target doesn't support it
time: 0.000; rss: 51MB	complete gated feature checking
Post-expansion node count: 68
time: 0.000; rss: 51MB	assigning node ids
time: 0.000; rss: 51MB	collecting defs
time: 0.003; rss: 51MB	external crate/lib resolution
time: 0.000; rss: 51MB	early lint checks
time: 0.001; rss: 59MB	name resolution
time: 0.000; rss: 59MB	lowering ast -> hir
time: 0.000; rss: 59MB	indexing hir
time: 0.000; rss: 59MB	attribute checking
time: 0.000; rss: 59MB	language item collection
time: 0.000; rss: 59MB	lifetime resolution
time: 0.000; rss: 59MB	looking for entry point
time: 0.000; rss: 59MB	looking for plugin registrar
time: 0.000; rss: 59MB	region resolution
time: 0.000; rss: 59MB	loop checking
time: 0.000; rss: 59MB	static item recursion checking
time: 0.000; rss: 59MB	load_dep_graph
time: 0.000; rss: 59MB	type collecting
time: 0.000; rss: 59MB	variance inference
time: 0.005; rss: 68MB	coherence checking
time: 0.000; rss: 68MB	wf checking
time: 0.000; rss: 68MB	item-types checking
time: 0.000; rss: 72MB	item-bodies checking
time: 0.000; rss: 72MB	drop-impl checking
time: 0.000; rss: 72MB	const checking
time: 0.000; rss: 72MB	privacy checking
time: 0.000; rss: 72MB	stability index
time: 0.000; rss: 72MB	intrinsic checking
time: 0.000; rss: 72MB	effect checking
time: 0.000; rss: 72MB	match checking
time: 0.000; rss: 72MB	liveness checking
time: 0.000; rss: 72MB	rvalue checking
time: 0.000; rss: 72MB	MIR dump
time: 0.001; rss: 72MB	MIR passes
time: 0.000; rss: 72MB	borrow checking
time: 0.000; rss: 72MB	reachability checking
time: 0.000; rss: 72MB	death checking
time: 0.000; rss: 72MB	stability checking
time: 0.000; rss: 72MB	unused lib feature checking
time: 0.000; rss: 72MB	lint checking
time: 0.001; rss: 72MB	resolving dependency formats
time: 0.000; rss: 72MB	Prepare MIR codegen passes
  time: 0.000; rss: 72MB	translation item collection
  time: 0.000; rss: 72MB	codegen unit partitioning
  time: 0.000; rss: 80MB	write metadata
time: 0.006; rss: 80MB	translation
time: 0.000; rss: 80MB	assert dep graph
time: 0.000; rss: 80MB	serialize dep graph
  time: 0.000; rss: 85MB	llvm function passes [0]
  time: 0.000; rss: 85MB	llvm module passes [0]
  time: 0.001; rss: 85MB	codegen passes [0]
  time: 0.000; rss: 85MB	codegen passes [0]
time: 0.002; rss: 85MB	LLVM passes
  time: 0.103; rss: 85MB	running linker
time: 0.103; rss: 85MB	linking
done
